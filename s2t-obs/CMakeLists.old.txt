cmake_minimum_required(VERSION 3.20)

project(obs-speech2text-plugin)

set(CMAKE_CXX_STANDARD 14)
set(VERSION_STRING "0.1")

add_compile_definitions(VERSION_STRING="${VERSION_STRING}")

set(THIRD_PARTY_DIR "third_party")
set(QTBASE_DIR "${THIRD_PARTY_DIR}/qtbase")
set(CONCURRENTQUEUE_DIR "${THIRD_PARTY_DIR}/concurrentqueue")
set(OBS_STUDIO_DIR "${THIRD_PARTY_DIR}/obs-studio")
set(SPDLOG_DIR "${THIRD_PARTY_DIR}/spdlog")
set(GRPC_DIR "${THIRD_PARTY_DIR}/grpc")

list(APPEND CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake/Modules/")

list(APPEND CMAKE_PREFIX_PATH
    "${QTBASE_DIR}/lib/cmake"
    "${OBS_STUDIO_DIR}/build/libobs"
    "${OBS_STUDIO_DIR}/build/UI/obs-frontend-api"
    "${SPDLOG_DIR}/cmake"
    "${CONCURRENTQUEUE_DIR}/build"
)
add_subdirectory(${GRPC_DIR})

# get Qt features like `qt_standard_project_setup`, `qt6_add_resources`, etc.
find_package(Qt6Widgets REQUIRED)
find_package(Qt6Core REQUIRED)
find_package(libobs REQUIRED) # target is `OBS::libobs`
find_package(obs-frontend-api REQUIRED) # target is `OBS::obs-frontend-api`
find_package(spdlog REQUIRED) # target is `spdlog::spdlog`

# Automatic call to UIC compiler to generate header files for .ui descriptions.
qt_standard_project_setup()
set(obs_QRC src/resources/obs.qrc)
qt6_add_resources(obs_QRC_SOURCES ${obs_QRC})

# OBS includes
include_directories(${OBS_STUDIO_DIR}/libobs)
include_directories(${OBS_STUDIO_DIR}/UI/obs-frontend-api/)

set(S2T_OBS_PLUGIN_SRCS
    src/plugin.cc
)
set(S2T_OBS_PLUGIN_HEADERS
    src/ui/caption_dock_widget.h
    src/ui/caption_main_widget.h
    src/ui/caption_manager.h
    src/ui/caption_settings_widget.h
    src/ui/open_caption_settings_widget.h

    ${CONCURRENTQUEUE_DIR}/concurrentqueue.h
    ${CONCURRENTQUEUE_DIR}/blockingconcurrentqueue.h
)

# We prefer using MODULE in our case :
# https://stackoverflow.com/questions/4845984/difference-between-modules-and-shared-libraries
add_library(s2t-obs-plugin MODULE
    ${S2T_OBS_PLUGIN_HEADERS}
    ${S2T_OBS_PLUGIN_SRCS}
    ${obs_QRC_SOURCES}
)

target_link_libraries(s2t-obs-plugin
    OBS::libobs
    OBS::obs-frontend-api
    Qt6::Widgets
    spdlog::spdlog
)


########################################################
# NEW CMAKE
########################################################

#####
# OBS
#####

